extends layout.pug

block pageName
  title Embedding VoteByMail.io
  meta(name="viewport", content="width=device-width, initial-scale=1.0")
  style.
    div > button {
      margin-right: 15px;
      margin-bottom: 15px;
    }

block content
  .container.mt-4
    h1 Embedding VoteByMail.io
    p This page guides you on creating embeddable versions of VoteByMail.io.  In order for these steps to be successful, you must be able to insert the iFrame into your page.  If using a Content Management System, like WordPress or Drupal, double-check that you're actually editing the raw content of the page and not using any WYSIWYG editor provided by these tools. Also, due to the safety measures adopted by modern browsers, your page must be HTTPS (not HTTP) for this to work.

    .card
      .card-body.row
        .col.col-md-6.col-sm-12.mt-3
          h4.text-primary Default State
          p Select default state (or no default)
          .input-group.mb-3
            select(
              id='prefill-state'
              class='form-control'
              aria-label='prefill state input'
              onChange=`setState(this.value)`
            )
              each state in states
                option(
                  aria-label=state
                  value=state
                )= state

        .col.col-md-6.col-sm-12.mt-3
          h4.text-primary Widget Code
          textarea(
            name='vbm-iframe-code'
            id='vbm-iframe-code'
            style='display: block; width: 100%; padding: 10px; color: #dc0e52; background-color: #fafafa; margin: 25px 0; border-radius: 4px; resize: none;'
            resizable='false'
            disabled='true'
          )=`${env.REACT_APP_URL}/#/org/${richOrg.id}`
          button(class='btn btn-primary' onClick='copyIframe()') Copy

    br
    h3 Preview
    div(
      id='vbm-iframe-wrapper'
      style='width: 100%;'
    )
      link(rel='stylesheet', href=`${env.REACT_APP_URL}/embed.min.css`)
      div.vote-by-mail__wrapper
        iframe(
          id='vbm-iframe'
          src=`${env.REACT_APP_URL}/#/org/${richOrg.id}`
          style='flex: 1;'
          marginheight='0'
          frameborder='0'
        )

        .vote-by-mail__bottom-bar
          .vote-by-mail__branding
            img(src=`${env.REACT_APP_URL}/favicon-32x32.png`)
          .vote-by-mail__actions
            button(
              class='vote-by-mail__bottom-button'
              onClick='vbmToggleTranslationDropdown()'
            )
              //- Chevron
              svg(xmlns='http://www.w3.org/2000/svg' version='1.1' width='8' height='8' viewbox='0 0 448 448' class='chevron')
                path(d='M420.75 332.75l-41.5 41.25c-6.25 6.25-16.25 6.25-22.5 0l-132.75-132.75-132.75 132.75c-6.25 6.25-16.25 6.25-22.5 0l-41.5-41.25c-6.25-6.25-6.25-16.5 0-22.75l185.5-185.25c6.25-6.25 16.25-6.25 22.5 0l185.5 185.25c6.25 6.25 6.25 16.5 0 22.75z')

              //- Globe
              svg(xmlns='http://www.w3.org/2000/svg' version='1.1' width='14' height='16' viewbox='0 0 384 448')
                path(d='M192 32c106 0 192 86 192 192s-86 192-192 192-192-86-192-192 86-192 192-192zM260.5 162.25c-2 1.5-3.25 4.25-5.75 4.75 1.25-0.25 2.5-4.75 3.25-5.75 1.5-1.75 3.5-2.75 5.5-3.75 4.25-1.75 8.5-2.25 13-3 4.25-1 9.5-1 12.75 2.75-0.75-0.75 5.25-6 6-6.25 2.25-1.25 6-0.75 7.5-3 0.5-0.75 0.5-5.5 0.5-5.5-4.25 0.5-5.75-3.5-6-7 0 0.25-0.5 1-1.5 2 0.25-3.75-4.5-1-6.25-1.5-5.75-1.5-5-5.5-6.75-9.75-1-2.25-3.75-3-4.75-5.25-1-1.5-1.5-4.75-3.75-5-1.5-0.25-4.25 5.25-4.75 5-2.25-1.25-3.25 0.5-5 1.5-1.5 1-2.75 0.5-4.25 1.25 4.5-1.5-2-4-4.25-3.5 3.5-1 1.75-4.75-0.25-6.5h1.25c-0.5-2.25-7.5-4.25-9.75-5.75s-14.25-4-16.75-2.5c-3 1.75 0.75 6.75 0.75 9.25 0.25 3-3 3.75-3 6.25 0 4.25 8 3.5 6 9.25-1.25 3.5-6 4.25-8 7-2 2.5 0.25 7 2.25 8.75 2 1.5-3.5 4-4.25 4.5-4.25 2-7.5-4.25-8.5-8-0.75-2.75-1-6-4-7.5-1.5-0.5-6.25-1.25-7.25 0.25-1.5-3.75-6.75-5.25-10.25-6.5-5-1.75-9.25-1.75-14.5-1 1.75-0.25-0.5-8-4.75-6.75 1.25-2.5 0.75-5.25 1.25-7.75 0.5-2 1.5-4 3-5.75 0.5-1 6-6.75 4.25-7 4.25 0.5 9 0.75 12.5-2.75 2.25-2.25 3.25-6 5.5-8.5 3.25-3.75 7.25 1 10.75 1.25 5 0.25 4.75-5.25 2-7.75 3.25 0.25 0.5-5.75-1.25-6.5-2.25-0.75-10.75 1.5-6.25 3.25-1-0.5-7 12-10.5 5.75-1-1.25-1.5-6.5-3.75-6.75-2 0-3.25 2.25-4 3.75 1.25-3.25-7-5.5-8.75-5.75 3.75-2.5 0.75-5.25-2-6.75-2-1.25-8.25-2.25-10-0.25-4.75 5.75 5 6.5 7.5 8 0.75 0.5 3.75 2.25 2 3.5-1.5 0.75-6 2-6.5 3-1.5 2.25 1.75 4.75-0.5 7-2.25-2.25-2.25-6-4-8.5 2.25 2.75-9 1.25-8.75 1.25-3.75 0-9.75 2.5-12.5-1.25-0.5-1-0.5-6.75 1-5.5-2.25-1.75-3.75-3.5-5.25-4.5-8.25 2.75-16 6.25-23.5 10.25 1 0.25 1.75 0.25 3-0.25 2-0.75 3.75-2 5.75-3 2.5-1 7.75-4 10.5-1.75 0.25-0.5 1-1 1.25-1.25 1.75 2 3.5 4 5 6.25-2-1-5.25-0.5-7.5-0.25-1.75 0.5-4.75 1-5.5 3 0.75 1.25 1.75 3.25 1.25 4.5-3.25-2.25-5.75-6-10.25-6.5-2 0-4 0-5.5 0.25-24 13.25-44.25 32.5-58.75 55.5 1 1 2 1.75 3 2 2.5 0.75 0 8 4.75 4.25 1.5 1.25 1.75 3 0.75 4.75 0.25-0.25 10.25 6.25 11 6.75 1.75 1.5 4.5 3.25 5.25 5.25 0.5 1.75-1 3.75-2.5 4.5-0.25-0.5-4-4.25-4.5-3.25-0.75 1.25 0 8 2.75 7.75-4 0.25-2.25 15.75-3.25 18.75 0 0.25 0.5 0.25 0.5 0.25-0.75 3 1.75 14.75 6.75 13.5-3.25 0.75 5.75 12.25 7 13 3.25 2.25 7 3.75 9.25 7 2.5 3.5 2.5 8.75 6 11.5-1 3 5.25 6.5 5 10.75-0.5 0.25-0.75 0.25-1.25 0.5 1.25 3.5 6 3.5 7.75 6.75 1 2 0 6.75 3.25 5.75 0.5-5.5-3.25-11-6-15.5-1.5-2.5-3-4.75-4.25-7.25-1.25-2.25-1.5-5-2.5-7.5 1 0.25 6.5 2.25 6 3-2 5 8 13.75 10.75 17 0.75 0.75 6.5 8.25 3.5 8.25 3.25 0 7.75 5 9.25 7.5 2.25 3.75 1.75 8.5 3.25 12.5 1.5 5 8.5 7.25 12.5 9.5 3.5 1.75 6.5 4.25 10 5.5 5.25 2 6.5 0.25 11-0.5 6.5-1 7.25 6.25 12.5 9 3.25 1.75 10.25 4.25 13.75 2.75-1.5 0.5 5.25 10.75 5.75 11.5 2.25 3 6.5 4.5 9 7.5 0.75-0.5 1.5-1.25 1.75-2.25-1 2.75 3.75 8 6.25 7.5 2.75-0.5 3.5-6 3.5-8-5 2.5-9.5 0.5-12.25-4.5-0.5-1.25-4.5-8.25-1-8.25 4.75 0 1.5-3.75 1-7.25s-4-5.75-5.75-8.75c-1.5 3-6.5 2.25-8-0.25 0 0.75-0.75 2-0.75 3-1.25 0-2.5 0.25-3.75-0.25 0.5-3 0.75-6.75 1.5-10 1.25-4.5 9.5-13.25-1.25-12.75-3.75 0.25-5.25 1.75-6.5 5-1.25 3-0.75 5.75-4.25 7.25-2.25 1-9.75 0.5-12-0.75-4.75-2.75-8-11.5-8-16.5-0.25-6.75 3.25-12.75 0-19 1.5-1.25 3-3.75 4.75-5 1.5-1 3.25 0.75 4-2.25-0.75-0.5-1.75-1.5-2-1.5 3.75 1.75 10.75-2.5 14 0 2 1.5 4.25 2 5.5-0.5 0.25-0.75-1.75-3.75-0.75-5.75 0.75 4.25 3.5 5 7.25 2.25 1.5 1.5 5.5 1 8.25 2.5 2.75 1.75 3.25 4.5 6.5 0.75 2 3 2.25 3 3 6 0.75 2.75 2.25 9.75 4.75 11 5.25 3.25 4-5.5 3.5-8.5-0.25-0.25-0.25-8.5-0.5-8.5-8-1.75-5-8-0.5-12.25 0.75-0.5 6.5-2.5 9-4.5 2.25-2 5-5.5 3.75-8.75 1.25 0 2.25-1 2.75-2.25-0.75-0.25-3.75-2.75-4.25-2.5 1.75-1 1.5-2.5 0.5-4 2.5-1.5 1.25-4.25 3.75-5.25 2.75 3.75 8.25-0.5 5.5-3.5 2.5-3.5 8.25-1.75 9.75-5 3.75 1 1-3.75 3-6.5 1.75-2.25 4.75-2.25 7-3.5 0 0.25 6.25-3.5 4.25-3.75 4.25 0.5 12.75-4 6.25-7.75 1-2.25-2.25-3.25-4.5-3.75 1.75-0.5 4 0.5 5.5-0.5 3.25-2.25 1-3.25-1.75-4-3.5-1-8 1.25-10.75 3zM219.75 381.5c34.25-6 64.75-23 87.75-47.25-1.5-1.5-4.25-1-6.25-2-2-0.75-3.5-1.5-6-2 0.5-5-5-6.75-8.5-9.25-3.25-2.5-5.25-5.25-10-4.25-0.5 0.25-5.5 2-4.5 3-3.25-2.75-4.75-4.25-9-5.5-4-1.25-6.75-6.25-10.75-1.75-2 2-1 5-2 7-3.25-2.75 3-6 0.5-9-3-3.5-8.25 2.25-10.75 3.75-1.5 1.25-3.25 1.75-4.25 3.25-1.25 1.75-1.75 4-2.75 5.75-0.75-2-5-1.5-5.25-3 1 6 1 12.25 2.25 18.25 0.75 3.5 0 9.25-3 12s-6.75 5.75-7.25 10c-0.5 3 0.25 5.75 3 6.5 0.25 3.75-4 6.5-3.75 10.5 0 0.25 0.25 2.75 0.5 4z')

            button(
              style='display: none;'
              class='vote-by-mail__bottom-button modal-close'
            ) &#10006;

        div(class='vote-by-mail__translation-dropdown dismissed' id='vbm-translation-dropdown')
          button(
            onClick=`vbmTranslate('es', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) Espa&ntilde;ol
          button(
            onClick=`vbmTranslate('zh-CN', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) #{'\u7b80\u4f53\u4e2d\u6587'}
          button(
            onClick=`vbmTranslate('tl', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) Filipino
          button(
            onClick=`vbmTranslate('vi', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) Ti#{'\u1ebf'}ng Vi#{'\u1ec7'}t
          button(
            onClick=`vbmTranslate('ar', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) #{'\u0627\u0644\u0639\u0631\u0628\u064a\u0629'}
          button(
            onClick=`vbmTranslate('fr', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) Fran#{'\u00e7'}ais
          button(
            onClick=`vbmTranslate('ko', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) #{'\ud55c\uad6d\uc5b4'}
          button(
            onClick=`vbmTranslate('ru', '${env.REACT_APP_URL}/#/org/${richOrg.id}')`
          ) #{'\u0440\u0443\u0441\u0441\u043a\u0438\u0439'}


        script(
          type='text/javascript'
          src=`${env.REACT_APP_URL}/embed.min.js`
        )
        script(
          type='text/javascript'
          src='//cdnjs.cloudflare.com/ajax/libs/iframe-resizer/3.5.3/iframeResizer.min.js'
        )
        //- More information about iFrameResize at
        //- http://davidjbradshaw.github.io/iframe-resizer/
        script iFrameResize({checkOrigin: false,scrolling: true,minHeight: 600,minWidth: 320,id: 'vbm-iframe'});
        link(rel="stylesheet", href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap")


  script.
    const iframeWrapper = document.getElementById('vbm-iframe-wrapper');
    const iframe = document.getElementById('vbm-iframe');
    const code = document.getElementById('vbm-iframe-code');
    // The initial value of code is env.REACT_APP_URL + orgId (we can't access these here)
    const baseUrl = code.value;
    let state = '';

    // When the iframe loads it might scroll to the address form, stealing
    // window focus, we don't want that.
    let lockScroll = false;
    let lockScrollPosition = 0;

    // Basically what we do is wait for a window scroll event, if it is
    // different than lockScrollPosition we will consider that the iframe
    // has finished loading, and with a short delay we'll unlock the page.
    //
    // We do this due to the safety measures blocking us from accessing
    // iframe.onload from this page.
    window.onscroll = function() {
      if (window.scrollY !== lockScrollPosition) {
        if (lockScroll) {
          window.scroll({ top: lockScrollPosition });
        }
        // Adding a small timeout since it's a smooth animation
        setTimeout(
          function() { lockScroll = false },
          500,
        );
      }
    }

    function copyIframe() {
      // Select will only work if disabled is false
      code.disabled = false;
      code.select();
      document.execCommand('copy');
      code.disabled = true;
    }

    // scrollY must be a number, and if present it will lock scrolling the
    // screen to the given position.
    function updateCode(scrollY) {
      // This is why our widget wasn't always updating, to see the changes
      // we must first clear the iframe.src and then (after a brief delay)
      // load our url.
      iframe.src = '';
      setTimeout(
        function() {
          iframe.src = `${baseUrl}${state}`;
          code.value = iframeWrapper.innerHTML;
          // we'll lock scrolling if scrollY is provided (when users change
          // default states).
          lockScroll = scrollY !== undefined
          lockScrollPosition = scrollY
        },
        50,
      );
    }

    function setState(s) {
      anchor = '';
      state = s !== 'No default state' ? `/address/${s}` : '';
      updateCode(window.scrollY);
    }

    // Initializes default values
    updateCode();
