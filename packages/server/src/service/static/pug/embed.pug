extends layout.pug

block pageName
  title Embedding VoteByMail.io
  meta(name="viewport", content="width=device-width, initial-scale=1.0")
  style.
    div > button {
      margin-right: 15px;
      margin-bottom: 15px;
    }

block content
  .container.mt-4
    h1 Embedding VoteByMail.io
    p This page guides you on creating embeddable versions of VoteByMail.io, in order for these steps to be successful you must at least have the power to edit HTML content from the pages you're wishing to edit, hence if using a Content Management System, like WordPress or Drupal, double-check that you're actually editing the raw content of the page and not using any WYSIWYG editor provided by these tools. Due to the safety measures adopted by modern browsers, these methods are only guaranteed to work on secure web pages, i.e. websites using SSL/HTTPS connections.

    br
    h2 Selecting the right widget
    p We make available multiple versions of the VoteByMail Widget to add to your website, this helps better fitting our application in your page, as well as helping voters sign up more efficiently.
    p Please note that all widgets offer the same functionality, but having only aesthetical differences among them.

    .row
      .col.col-lg-6.col-sm-12
        .card.mt-4.p-3
          .card-body
            h3 Portrait widgets
            p These are ideal for mobile devices or when you need to fit VoteByMail Widget in a constrained space.
            p.text-muted Small (340x620) will display correctly on all smartphones and desktop devices.
            button(
              type='button'
              class='btn btn-primary'
              onClick="setDimensions('340px', '620px')"
            ) Small (340x620)
            button(
              type='button'
              class='btn btn-primary'
              onClick="setDimensions('768px', '1024px')"
            ) Big (768x1024)

      .col.col-lg-6.col-sm-12
        .card.mt-4.p-3
          .card-body
            h3 Landscape widgets
            p These are ideal for wider devices such as computers and tablets, but essentially great for webpages with lots of space available.
            p.text-muted We suggest you to use the Flexible Widget below if you need even bigger dimensions.
            button(
              type='button'
              class='btn btn-primary'
              onClick="setDimensions('1024px', '768px')"
            ) Small (1024x768)
            button(
              type='button'
              class='btn btn-primary'
              onClick="setDimensions('1366px', '768px')"
            ) Big (1366x768)

      .col.col-lg-6.col-sm-12
        .card.mt-4.p-3
          .card-body
            h3 Organization changes
            p You can fill the input below to replace the default organization used by our website. If you plan to replace the default organization with one of yours, we recommend you to select them by clicking on its respective button.
            p.text-muted Only manually type in the field below to generate a Widget for an unlisted organization.
            each org in richOrgs
              button(
                onClick=`setOrg('${org.id}', true)`
                aria-label=org.name ? `${org.name} (${org.id})` : org.id
                class='btn btn-primary'
              )= org.name ? `${org.name} (${org.id})` : org.id
            .input-group.mb-3
              input(
                id='vbm-iframe-org-input'
                class='form-control'
                placeholder='Custom org id, e.g. vbm_org'
                onChange='setOrg(this.value)'
                aria-label='custom org input'
              )
              .input-group-append
                // This button actually does nothing, but vanilla js
                // onChange might trigger only after the input is blurred
                // on some browsers, unlike the default behavior in React
                button(
                  class='btn btn-primary'
                  aria-label='save changes'
                ) Save

      .col.col-lg-6.col-sm-12
        .card.mt-4.p-3
          .card-body
            h3 Flexible Widget
            p This embedded version of VoteByMail will fill the entire space available by its parent container, this feature allows this widget to responsively adapt to both mobile and desktop devices, although some CSS knowledge will be required in order to implement this functionality.
            p.text-muted Remember to set both #[code height] and #[code width] of the parent container, otherwise the widget won't expand at all.
            button(
              type='button'
              class='btn btn-primary'
              onClick="setDimensions('100%', '100%')"
            ) Flexible Dimensions

  .container.mt-4
    br
    h2 Widget code
    br
    div.alert.alert-secondary(style='background-color: #fbfbfb;')
      p Please copy the text in red and add it to your website, the code in this block updates automatically as you edit your widget.
      code(id='vbm-iframe-code')= env.REACT_APP_URL


    br
    h3 Preview
    p.text-muted The dashed red border indicates the available space for the widget, except for #[b Flexible Widget] this area might be overlapped by other options.
    div(style='height: 1024px; width: 100%; border: 2px dashed #dc0e52;')
      iframe(
        id='vbm-iframe'
        src=`${env.REACT_APP_URL}/${org}`
      )


  script.
    let width = '340px';
    let height = '620px';
    let org = '';
    const iframe = document.getElementById('vbm-iframe');
    const code = document.getElementById('vbm-iframe-code');
    // The initial value of code is env.REACT_APP_URL (we can't access env here)
    const baseUrl = code.innerText;

    function setDimensions(w, h) {
      width = w;
      height = h;
      iframe.style.width = w;
      iframe.style.height = h;
      code.innerText = iframe.outerHTML;
    }

    function setOrg(oid, clearInput) {
      org = `#/org/${oid ? oid : 'default'}`;
      iframe.src = `${baseUrl}/${org}`;
      code.innerText = iframe.outerHTML;
      if (clearInput) {
        document.getElementById('vbm-iframe-org-input').value = ''
      }
    }

    // Initialize default values
    setDimensions(width, height)
    setOrg(org)
