extends layout.pug

block pageName
  title Embedding VoteByMail.io
  meta(name="viewport", content="width=device-width, initial-scale=1.0")
  style.
    div > button {
      margin-right: 15px;
      margin-bottom: 15px;
    }

block content
  .container.mt-4
    h1 Embedding VoteByMail.io
    p This page guides you on creating embeddable versions of VoteByMail.io.  In order for these steps to be successful, you must be able to insert the iFrame into your page.  If using a Content Management System, like WordPress or Drupal, double-check that you're actually editing the raw content of the page and not using any WYSIWYG editor provided by these tools. Also, due to the safety measures adopted by modern browsers, your page must be HTTPS (not HTTP) for this to work.

    .row
      .col.col-lg-6.col-sm-12
        .card.mt-4.p-3
          .card-body
            h3 Organization changes
            p You can fill the input below to replace the default organization used by our website. If you plan to replace the default organization with one of yours, we recommend you to select them by clicking on its respective button.
            p.text-muted Only manually type in the field below to generate a Widget for an unlisted organization.
            each org in richOrgs
              button(
                onClick=`setOrg('${org.id}', true)`
                aria-label=org.name ? `${org.name} (${org.id})` : org.id
                class='btn btn-primary'
              )= org.name ? `${org.name} (${org.id})` : org.id
            .input-group.mb-3
              input(
                id='vbm-iframe-org-input'
                class='form-control'
                placeholder='Custom org id, e.g. vbm_org'
                onChange='setOrg(this.value)'
                aria-label='custom org input'
              )
              .input-group-append
                // This button actually does nothing, but vanilla js
                // onChange might trigger only after the input is blurred
                // on some browsers, unlike the default behavior in React
                button(
                  class='btn btn-primary'
                  aria-label='save changes'
                ) Save

      .col.col-lg-6.col-sm-12
        .card.mt-4.p-3
          .card-body
            h3 Anchor
            p Setting a HTML anchor will replace the default starting point of any web page, for example, in VoteByMail you can set the page to start showing the "About Us" section instead from the top.
            //- The dashes below are em dashes, although most monospace fonts are
            //- going to render them equally as a dash
            p It's possible to set this to any of the sections of our landing page, or—if you want to speed up the sign up process—fill the default value of the zip code.
            button(
              type='button'
              class='btn btn-primary'
              onClick="setAnchor('')"
            ) Default (top)
            button(
              type='button'
              class='btn btn-primary'
              onClick="setAnchor('#howItWorks')"
            ) How does it work?
            button(
              type='button'
              class='btn btn-primary'
              onClick="setAnchor('#getInvolved')"
            ) Get Involved
            button(
              type='button'
              class='btn btn-primary'
              onClick="setAnchor('#team')"
            ) Team
            button(
              type='button'
              class='btn btn-primary'
              onClick="setAnchor('#contact')"
            ) Contact Us
            button(
              type='button'
              class='btn btn-primary'
              onClick="setAnchor('#about')"
            ) About Us
            br
            label(for='prefill-zip') Prefill Zip Code
            div(class='input-group mb-3' style='max-width:370px')
              input(
                id='prefill-zip'
                class='form-control'
                placeholder='Prefill zip code, e.g. 33131'
                onChange='setZip(this.value)'
                aria-label='custom org input'
                pattern='[0-9]{5}'
                type='number'
              )
              .input-group-append
                // This button actually does nothing, but vanilla js
                // onChange might trigger only after the input is blurred
                // on some browsers, unlike the default behavior in React
                button(
                  class='btn btn-primary'
                  aria-label='save changes'
                ) Save

  .container.mt-4
    br
    h2 Widget code
    br
    div.alert.alert-secondary(style='background-color: #fbfbfb;')
      p Please copy the text in red and add it to your website, the code in this block updates automatically as you edit your widget.
      code(id='vbm-iframe-code')= env.REACT_APP_URL

    br
    h3 Preview
    p.text-muted The dashed red border indicates the available space for the widget.
    div(style='width: 100%; height: 1024px; border: 2px dashed #dc0e52;')
      iframe(
        id='vbm-iframe'
        src=`${env.REACT_APP_URL}/${org}`
        style='width: 100%; height: 100%;'
      )


  script.
    let org = '';
    const iframe = document.getElementById('vbm-iframe');
    const code = document.getElementById('vbm-iframe-code');
    // The initial value of code is env.REACT_APP_URL (we can't access env here)
    const baseUrl = code.innerText;
    let anchor = '';
    let zip = '';

    function updateCode() {
      iframe.src = `${baseUrl}/${org}${anchor}${zip}`;
      code.innerText = iframe.outerHTML;
    }

    function setOrg(oid, clearInput) {
      org = `#/org/${oid ? oid : 'default'}`;
      updateCode();
      if (clearInput) {
        document.getElementById('vbm-iframe-org-input').value = '';
      }
    }

    function setAnchor(a) {
      anchor = a;
      updateCode();
    }

    function setZip(z) {
      zip = z ? `?postcode=${z}` : ''
      updateCode();
    }

    // Initialize default values
    setOrg(org);
